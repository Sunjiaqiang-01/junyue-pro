# 君悦SPA - 技师预约服务平台需求文档

## 📋 项目概述

君悦SPA是一个基于邀请制的技师预约服务平台，连接用户与技师，提供线上预约、线下服务的完整解决方案。平台采用分佣裂变模式，支持多级代理分成，致力于打造可持续发展的服务生态。

## 💎 服务项目体系

### 🏆 基础舒缓SPA (498元/60分钟)
**服务内容：** 基础舒缓SPA，体推，全身推油，背部保养，全身按摩，颈部保养，私密护理

**适用人群：** 初次体验用户，注重基础放松的客户
**服务时长：** 60分钟
**定价策略：** 
- 服务费用：498元
- 预约定金：249元 (50%)
- 服务尾款：249元 (现场支付给技师)

### 🌟 进阶焕活SPA (598元/80分钟)  
**服务内容：** 进阶焕活SPA，包含基础项目全部内容，额外增加头疗，激情助浴，耳功调息，手部导流

**适用人群：** 有一定SPA体验的用户，追求更全面服务的客户
**服务时长：** 80分钟
**定价策略：**
- 服务费用：598元
- 预约定金：299元 (50%)
- 服务尾款：299元 (现场支付给技师)

### ✨ 奢华尊享SPA (698元/90分钟)
**服务内容：** 奢华尊享SPA，包含基础+进阶全部内容，额外增加花式沐浴，水晶之恋，颈部护理，深度放松

**适用人群：** 高端客户，追求极致体验和服务品质的用户
**服务时长：** 90分钟  
**定价策略：**
- 服务费用：698元
- 预约定金：349元 (50%)
- 服务尾款：349元 (现场支付给技师)

## 🔄 核心业务流程

### 📱 完整订单流程
```
用户浏览技师 → 选择服务项目 → 确认时间地点 → 阅读"只换不退"规则 
    ↓
支付50%定金 → 系统自动电话通知技师 → 技师10分钟内接单/拒单
    ↓
【技师接单】→ 双方联系方式开放 → 自由沟通协调 → 现场服务 → 尾款支付
    ↓
【技师拒单】→ 定金退还为正式积分 → 用户重新选择技师
```

**订单状态流转**：
- 待支付 → 待接单 → 已接单 → 服务中 → 已完成 → 已评价
- 拒单/超时 → 已退款（积分形式）

### 📞 技师订单通知系统
1. **自动语音电话**：
   - 用户支付定金后30秒内自动拨打技师电话
   - 语音播报：您在君悦平台有新的订单、服务项目、时间、位置、定金金额
   - 重复播报3次

2. **响应时限**：
   - 技师10分钟内必须响应
   - 超时未响应自动拒单
   - 最多重拨3次，每次间隔3分钟（第1次立即拨打，第2次3分钟后，第3次6分钟后）
   - 技师在任何一次电话中接单均视为有效

### 🤝 现场联系机制
**技师接单后立即开放双方联系方式**：
- 订单页面同时显示双方手机号码/其他联系方式，比如微信/QQ
- 用户和技师可直接电话沟通协调具体见面细节
- 服务完成后联系方式自动隐藏

## 💎 双积分体系管理

### 🏆 正式积分（现金等值）
**获得方式**：
- 技师拒单后的定金退还
- 客服补偿

**使用规则**：
- ✅ 永久有效，无过期时间
- ✅ 可用于下单时抵扣定金任意金额
- ✅ 可用于解锁技师联系方式（99积分）
- ✅ 1积分 = 1元人民币

### ⏰ 临时积分（签到奖励）

#### 📅 阶梯递增签到规则（月度90积分上限）
每月1号重置，按签到天数累积获得积分：

**第1周（1-7天）**：每天2积分，第7天额外+6积分 = 共20积分
**第2周（8-14天）**：每天3积分，第14天额外+8积分 = 共29积分  
**第3周（15-21天）**：每天3积分，第21天额外+10积分 = 共31积分
**第4周（22-28天）**：每天4积分，第28天额外+8积分 = 共36积分
**最后几天（29-31天）**：每天3积分 = 共9积分

**月度理论总计**：125积分，但系统限制90积分上限

#### 🎯 实际获得逻辑
- 用户前25天签到可获得约80积分
- 继续签到直到达到90积分上限（大约27-28天）
- 达到上限后继续签到显示"今日已达上限，感谢坚持！"
- 必须几乎每天签到才能达到90积分满额

#### 📱 用户界面显示示例

```markdown
🗓️ 今日签到
━━━━━━━━━━━━━━━━━━━━━━━━
📅 本月第25天签到
💎 今日可获得：4积分
🔥 连续签到：25天
📊 本月累计：82积分/90积分
🎯 距离满额还需：8积分（约2天）
━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 断签将重置连续天数，影响周奖励！
```

#### ⚠️ 断签影响机制
1. **连续天数重置**：断签后连续天数归零，重新开始计算
2. **周奖励丢失**：无法获得对应周期的高额奖励积分
3. **后期损失巨大**：越到月末断签损失越大（4积分/天+周奖励）
4. **月度上限难达成**：断签2-3天基本无法达到90积分上限

#### 💡 设计优势
1. **更高激励**：90积分上限提供更大优惠空间
2. **必须全勤**：几乎需要每天签到才能达到上限
3. **阶梯压力**：从2积分递增到4积分，后期价值更高
4. **心理锁定**：临近90积分时，用户舍不得前功尽弃
5. **强制粘性**：要获得满额积分，必须保持28天左右的高频访问

**使用限制**：
- ⚠️ 60天有效期，过期自动清零
- ⚠️ 单次下单最多使用30个临时积分（抵扣定金部分）
- ⚠️ 不能用于解锁联系方式
- ⚠️ 仅限下单定金时抵扣使用

### 💰 积分使用规则
**自动抵扣顺序**：
1. 优先使用临时积分（快过期的先用）
2. 再使用正式积分
3. 最后使用现金支付

**使用示例**：
```
下单498元基础SPA（需支付定金249元）：
- 用户拥有：临时积分25个、正式积分100个
- 系统自动计算：
  * 优先使用25个临时积分（因单次最多用30个，且快过期）
  * 再使用22个正式积分
  * 共抵扣：25 + 22 = 47元
- 实际支付定金：249 - 47 = 202元
- 服务完成后现场支付尾款：249元（直接给技师）
- 用户总支出：202 + 249 = 451元
```

## 🎯 核心功能模块

### 1. 用户端功能

#### 1.1 浏览与选择
- **项目展示**：三档SPA服务详细介绍和价格对比
- **技师筛选**：
  - 按城市、区域精准定位筛选
  - 按身高高低排序筛选
  - 按体重高低排序筛选
  - 按年龄高低排序筛选
  - 提供搜索框，关键字搜索功能
  - 在线状态筛选：显示技师当前在线状态，优先展示在线技师
  - 显示新技师，优先展示新技师
  - 显示推荐技师，优先展示推荐技师，优先级高于新技师
- **技师详情页**：
  - 多张个人照片和个人视频
  - 基本信息（昵称、年龄、身高、体重）
  - 服务城市和可服务区域
  - 个人介绍和服务特色
  - 可预约时间段实时更新
  - 用户评价展示（管理员审核通过的）
  - 联系方式电话/微信/QQ等（默认隐藏，付费99积分永久解锁）

#### 1.2 预约下单
- **服务配置选择**：
  - 选择服务项目（基础498元/进阶598元/奢华698元）
  - 确定服务时间（日期+具体时段）
  - 选择服务方式（技师上门/到技师指定地点）
  - 填写服务地址和联系方式
  - 备注特殊需求和注意事项
- **"只换不退"政策确认**：
  - 下单前弹窗显示政策详情
  - 用户必须勾选"我已阅读并同意"
  - 明确说明：技师拒单退还等值正式积分，不退现金
- **积分抵扣选择**：
  - 自动显示可用积分余额（正式+临时）
  - 智能推荐最优抵扣方案
  - 用户可手动调整抵扣金额
  - 实时计算最终支付金额
- **支付流程**：
  - 通过SemiPay支付50%定金锁定订单
  - 系统自动识别收款并确认订单状态
  - 服务完成后50%尾款直接现金支付给技师

#### 1.3 联系方式解锁
- **付费解锁**：使用99积分（或支付99元）永久解锁技师联系方式
- **永久联系**：解锁后可绕过平台直接沟通，自由协商服务
- **收益分配**：解锁费用100%归平台所有

#### 1.4 用户互动
- **双积分签到系统**：每日签到获得临时积分
- **匿名评价系统**：服务完成后可对技师进行匿名评价，管理员可以选择是否显示评价内容
- **留言板**：向站长反馈建议，增加用户粘性
- **技师收藏功能**：收藏喜欢的技师，快速预约
- **积分变动提醒**：积分获得、使用、过期提醒

### 2. 技师端功能

#### 2.1 注册与认证
- **邀请注册**：通过技师邀请码注册，建立上下级分佣关系
- **身份认证**：技师需要添加管理员微信，管理员手动审核，确保技师真实身份
- **资料完善**：
  - 基本信息：昵称、年龄、身高、体重、所在城市
  - 多媒体上传：个人照片（至少3张）、个人介绍视频
  - 个人介绍：个人专长、服务特色、可服务区域
  - 服务时间：可服务时间段，可设置多个时间段
  - 服务方式：技师上门/到技师指定地点/双方协商
  - 服务地址：服务地址，通过腾讯地图API获取
  - 联系方式：电话/微信/QQ等（默认隐藏，用户付费99积分解锁）
- **状态管理**：在线/离线状态实时更新，影响用户端展示优先级

#### 2.1.1 技师审核标准
- **照片要求**：
  - 至少3张清晰照片，包含正面、侧面、全身照
  - 照片真实无过度美化，与本人相符
  - 不得使用网图或他人照片
- **视频要求**：
  - 时长30秒以上，需露脸并简单自我介绍
  - 画面清晰，声音清楚
- **信息真实性**：
  - 年龄、身高、体重等信息需与照片/视频相符
  - 联系方式必须真实有效，能够联系到本人
- **审核时效**：
  - 提交后48小时内完成审核
  - 审核通过后技师状态变为"已认证"
  - 审核不通过会说明原因，技师可修改后重新提交
- **审核不通过常见原因**：
  - 照片模糊或使用网图
  - 视频不符合要求
  - 信息明显造假
  - 联系方式无效

#### 2.2 订单管理
- **订单通知系统**：
  - 自动语音电话通知：播报订单详情（项目、时间、位置、金额）
- **快速响应机制**：
  - 10分钟响应窗口，倒计时显示
  - 一键接单/拒单，可添加拒单原因，通知给用户
  - 超时自动拒单，定金自动退还为正式积分
- **订单状态管理**：
  - 待响应 → 已接单 → 服务中 → 已完成 → 已评价
  - 实时订单状态同步，双方可见
- **客户沟通功能**：
  - 接单后自动开放联系方式

#### 2.3 收益管理
- **推广收益管理**：
  - 下级技师邀请记录
  - 分成收益明细查询
  - 邀请码生成和分享
- **提现功能**：
  - 收益提现申请（最低100元）
  - 提现记录查询
  - 到账状态实时通知，到账后通知用户

### 3. 管理端功能

#### 3.1 全局数据管理
- **运营数据看板**：
  - 核心指标展示：日活用户、订单量、GMV、转化率、技师收益、用户收益
  - 趋势分析：1天/7天/30天数据对比图表
  - 地域分布：用户和技师的城市分布热力图，用户和技师的城市分布饼图

- **用户管理增强**：
  - 用户画像分析：消费频次、偏好服务、活跃度评分、用户行为轨迹：注册→首单→复购的完整路径分析
  - 用户分群管理：新用户、活跃用户、流失用户、高价值用户
  - 批量操作：批量发送积分、批量消息推送、批量退款、批量状态修改
  - 积分审计：积分变动记录，防止异常操作

- **技师管理升级**：
  - 技师绩效看板：接单率、完成率、收益排行、
  - 多维度筛选：按城市/接单量/注册时间筛选
  - 状态监控：实时在线状态、最后活跃时间
  - 资料审核流程：待审核→已通过→需修改→已拒绝

- **订单管理深化**：
  - 订单全生命周期监控：从下单到评价的完整流程
  - 异常订单预警：超时未接单、异常退款、投诉订单
  - 订单数据分析：高峰时段、热门服务项目、地域偏好

#### 3.2 内容管理
- **公告管理**：发布更新平台重要信息
- **留言管理**：查看回复用户反馈建议

#### 3.3 代理系统
- **代理设置**：添加管理平台代理商
- **分佣配置**：自定义代理分成比例
- **邀请码管理**：生成专属推广邀请码
- **推广效果分析**：注册转化率、订单转化率、LTV分析

#### 3.4 佣金提现管理
- **提现工单处理**：查看审核用户提现申请
- **批量转账管理**：导出提现清单，批量处理转账
- **提现记录管理**：查看所有提现历史和状态
- **对账系统**：提现金额核对和财务管理
- **风控监控**：异常提现行为检测和处理

#### 3.5 系统管理
- **代理商管理页面**：查看代理商信息、代理商订单、代理商收益、提现记录、代理商提现申请

## 🔐 邀请制度设计

### 邀请码类型
- **用户邀请码**：新用户注册使用
- **技师邀请码**：新技师注册使用  
- **代理邀请码**：代理专属推广码

### 分佣规则
- **用户推荐用户**：被推荐用户消费时，推荐人获得订单总额10%佣金
- **技师推荐技师**：被推荐技师接单时，推荐人获得订单总额5%分成
- **代理推广**：代理邀请的用户/技师产生交易时，代理获得可配置比例分成
- **佣金来源**：所有推荐佣金从平台定金收入中扣除

### 邀请码机制详解
- **生成规则**：
  - 用户邀请码：8位数字+字母组合，注册时自动生成
  - 技师邀请码：8位数字+字母组合，审核通过后自动生成
  - 代理邀请码：由管理员在后台生成，可自定义前缀
- **有效期**：永久有效，除非管理员手动禁用
- **使用次数**：无限次使用
- **注册机制**：
  - 用户注册：可选填邀请码（有邀请码享受推荐奖励，无邀请码也可注册）
  - 技师注册：必须填写邀请码（建立分佣关系）
  - 代理推广：使用专属链接或邀请码

## 💰 变现模式

### 主要收入来源
1. **定金收入**：订单定金100%归平台所有
2. **联系方式解锁费**：用户付费99积分/99元永久解锁技师联系方式
3. **代理分成收益**：代理推广用户/技师产生的订单收益

### 收益分配详解

#### 订单收益分配（以498元基础SPA为例）
**基础分成**：
- 用户支付定金：249元 → 100%归平台
- 用户支付尾款：249元 → 100%归技师（现场支付）
- 平台与技师分成比例：50:50

**存在推荐关系时的分配**：
假设场景：用户A推荐用户B注册，技师C推荐技师D注册，B预约了D的498元服务

1. **定金收入**：249元
2. **扣除推荐佣金**：
   - 用户推荐佣金：498 × 10% = 49.8元（给用户A）
   - 技师推荐分成：498 × 5% = 24.9元（给技师C）
   - 合计扣除：74.7元
3. **平台净收入**：249 - 74.7 = 174.3元
4. **技师D收入**：249元（尾款全部）

**三档服务收益对比**：

| 服务套餐 | 订单总额 | 定金 | 尾款 | 用户推荐10% | 技师推荐5% | 平台净收入 | 技师收入 |
|---------|---------|------|------|------------|-----------|-----------|---------|
| 基础SPA | 498元 | 249元 | 249元 | 49.8元 | 24.9元 | 174.3元 | 249元 |
| 进阶SPA | 598元 | 299元 | 299元 | 59.8元 | 29.9元 | 209.3元 | 299元 |
| 奢华SPA | 698元 | 349元 | 349元 | 69.8元 | 34.9元 | 244.3元 | 349元 |

**无推荐关系时**：
- 平台收入：249元/299元/349元（100%定金）
- 技师收入：249元/299元/349元（100%尾款）

#### 联系方式解锁收益
- 用户支付：99积分或99元
- 平台收入：100%（99元）
- 技师收入：无
- 说明：解锁后用户可永久联系技师，绕过平台交易

#### 代理收益分配
- 代理推广佣金比例：由管理员在后台自定义配置（建议5%-15%）
- 计算基数：订单总额
- 佣金来源：从平台定金收入中扣除
- 示例：代理配置10%，498元订单，代理获得49.8元

### 商业模式保护
- **订单联系 vs 付费解锁**：订单期间仅临时开放联系方式，付费解锁获得永久联系权限
- **积分防白嫖**：临时积分限制使用场景和金额（单次最多30个），防止用户纯靠签到下单
- **只换不退政策**：保护平台现金流，用积分引导用户继续消费
- **定金锁定机制**：定金支付后立即归平台所有，技师拒单退积分不退现金

## 🎨 用户体验优化

### 首页展示
- **分佣规则说明**：清晰展示邀请分成机制
- **成功案例**：展示用户获得收益的真实案例  
- **公告栏**：实时更新平台重要信息

### 用户粘性策略
- **每日签到**：临时积分激励，培养访问习惯
- **积分提醒**：临时积分过期前7天开始提醒使用
- **社区互动**：留言板增强用户参与感和归属感

## 🔧 技术实现要点

### 核心技术需求
- **自动语音系统**：集成第三方语音服务，实现订单自动通知
- **支付集成**：支持定金和尾款分离支付，积分抵扣功能
- **双积分系统**：正式积分和临时积分的分别管理和使用限制
- **联系方式控制**：基于订单状态的联系方式显示/隐藏机制

## 💳 支付解决方案

### 收款方案：SemiPay开源支付系统
**技术特点**：
- 开源免费，基于个人收款码的自动化系统
- 支持Vercel一键部署，免域名备案
- 适合香港服务器部署，支持国内用户
- 通过Telegram机器人实时通知收款
- 支持微信、支付宝个人收款码轮询

**实施步骤**：
1. 从GitHub部署SemiPay：`https://github.com/wanghsinche/semipay`
2. 配置个人微信、支付宝收款码
3. 集成Telegram机器人通知
4. 对接平台订单系统API

### 佣金提现方案：手动转账处理
**操作流程**：
```
用户申请提现 → 系统生成提现工单 → 人工审核 → 微信/支付宝手动转账 → 标记完成
```

**管理策略**：
- **最低提现额度**：100元（减少处理频次）
- **处理时间**：每天下午2点统一处理
- **工作制度**：工作日处理，周末暂停提现
- **处理周期**：1-3个工作日到账

**技术实现**：
- 开发提现申请页面和工单系统
- 后台提现管理界面，支持批量导出
- 提现状态实时通知（申请中/处理中/已完成）
- 提现记录查询和对账功能

**风险控制**：
- 用户身份验证：绑定真实姓名和手机号
- 提现频次限制：每天最多1次提现申请
- 异常监控：大额提现需要额外审核
- 资金安全：专用账户管理，定期对账

### 安全与合规
- **邀请码验证**：防止恶意注册和刷积分行为
- **用户认证**：确保平台用户真实性和安全性
- **交易安全**：保障资金流转和积分使用安全可靠
- **隐私保护**：联系方式限时开放，服务结束后自动隐藏

## 📈 运营策略

### 冷启动方案
1. **邀请制控制**：确保初期用户和技师质量
2. **代理合作**：利用现有中介资源快速获取客户和技师
3. **高分成激励**：早期给予高比例分成吸引推广者

### 长期发展
1. **品牌建设**：打造可信赖的高端SPA服务平台形象
2. **生态完善**：持续优化用户和技师体验，提升服务质量
3. **规模扩张**：逐步覆盖更多城市和服务类型

## ⚠️ 重要政策说明

### 用户须知
- **只换不退**：支付定金后，如技师拒单退还等值正式积分，不退现金
- **联系方式使用**：订单期间开放的联系方式仅限服务协调使用
- **积分有效期**：临时积分60天有效，正式积分永久有效

### 技师规范
- **及时响应**：收到订单通知后10分钟内必须响应
- **诚信服务**：接单后不得无故取消或提供虚假联系方式
- **配合管理**：积极配合平台的各项管理和优化措施

## 🔧 订单异常场景处理

### 用户侧异常场景

#### 1. 用户支付后想取消订单
**场景**：用户支付定金后，技师还未接单，用户想取消
**处理方案**：
- 技师未接单前：可申请取消，定金退还为正式积分（不退现金）
- 技师已接单后：不可取消，如需取消需联系客服，按具体情况处理

#### 2. 技师连续多次拒单
**场景**：用户预约多个技师，都被拒单，积分越来越多
**处理方案**：
- 定金自动退还为正式积分
- 用户可使用积分继续预约其他技师
- 系统记录技师拒单率，拒单率过高（>30%）的技师会被降低展示优先级
- 客服可根据情况给予额外补偿或人工介入匹配

#### 3. 服务过程中发生纠纷
**场景**：用户和技师对服务内容有分歧
**处理方案**：
- 用户可在订单详情页点击"申诉"按钮
- 必须提供问题说明和证据（文字/图片）
- 客服24小时内介入调查
- 根据调查结果进行处理：
  * 技师责任：退还尾款积分，技师警告或封号
  * 用户责任：技师正常收款，用户警告
  * 双方责任：协商解决
  * 无法判定：按比例退款

#### 4. 用户未按时到达
**场景**：用户预约后未按时到达服务地点
**处理方案**：
- 等待时间超过30分钟，技师可选择"用户爽约"
- 定金不退还，技师获得50%定金作为补偿（249元订单获得124.5元）
- 用户账号记录爽约次数，超过3次限制下单功能

### 技师侧异常场景

#### 1. 技师接单后临时取消
**场景**：技师已接单，但临时有事无法提供服务
**处理方案**：
- 接单后2小时内取消：警告，定金退还用户为正式积分
- 接单后2小时-服务前1小时取消：扣除信誉分，定金退还
- 服务前1小时内取消：严重违规，扣除信誉分，暂停接单3天
- 多次取消（>3次/月）：永久封号

#### 2. 技师未按时到达
**场景**：技师接单后未按约定时间到达
**处理方案**：
- 迟到30分钟内：用户可选择继续等待或取消，取消则定金退积分
- 迟到超过30分钟：视为技师违约，定金退还用户，技师扣信誉分
- 完全未到：严重违规，定金退还，技师封号处理

#### 3. 技师提供的服务与描述不符
**场景**：用户反馈技师实际情况与资料不符
**处理方案**：
- 用户提交申诉并提供证据
- 管理员核实后：
  * 属实：要求技师更新资料，严重者封号
  * 不属实：驳回申诉
- 多次投诉属实（>3次）：永久封号

### 平台侧异常场景

#### 1. 支付系统故障
**场景**：用户支付成功但系统未收到回调
**处理方案**：
- SemiPay Telegram通知管理员收款
- 管理员在后台手动确认订单
- 补发技师接单通知
- 记录异常日志，技术排查

#### 2. 自动语音系统故障
**场景**：语音通知未能成功拨打
**处理方案**：
- 系统自动重试3次
- 仍然失败则发送短信/站内通知
- 延长技师响应时间到20分钟
- 记录异常日志

## 📍 时间预约和服务范围规则

### 时间预约机制

#### 时间段设置
- **精度**：以30分钟为最小单位
- **时间范围**：当前时间起至未来30天
- **技师可用时间**：
  - 技师在个人中心设置每日可服务时间段
  - 可设置重复时间段（如每天9:00-23:00）
  - 可设置特定日期的特殊时间段
  - 实时更新，修改后立即生效

#### 预约规则
- **提前预约时间**：至少提前2小时预约
- **时间冲突处理**：
  - 技师接单后，该时间段自动标记为"已预约"
  - 已预约时间段在用户端显示为灰色不可选
  - 订单取消或完成后，时间段自动释放
- **服务时长计算**：
  - 基础SPA 60分钟，系统自动占用1.5小时时间段（含准备和收尾）
  - 进阶SPA 80分钟，占用2小时时间段
  - 奢华SPA 90分钟，占用2.5小时时间段

### 服务范围规则

#### 地理位置设置
- **技师服务范围**：
  - 必须设置主要服务城市（单选）
  - 可设置服务区域（多选）：如朝阳区、海淀区
  - 可设置服务半径：3公里/5公里/10公里/全城
  - 上门服务需设置最远距离限制

#### 距离计算
- **使用腾讯地图API**：
  - 计算用户地址到技师位置的直线距离
  - 显示预计行程时间
  - 用户可查看技师是否在服务范围内
- **跨区服务**：
  - 超出服务范围的订单会标注"距离较远"
  - 技师可自行决定是否接单
  - 建议用户优先选择附近技师

#### 服务方式
- **技师上门**：技师前往用户指定地址
- **到技师指定地点**：用户前往技师提供的地址
- **双方协商**：接单后双方自行沟通决定

## 📲 通知系统完整方案

### 通知渠道

#### 1. 自动语音电话（技师订单通知）
- **触发时机**：用户支付定金后30秒
- **语音内容**：
  ```
  您好，您在君悦SPA平台有新的订单。
  服务项目：【基础舒缓SPA】
  服务时间：【2025年10月5日 14:00】
  服务地点：【北京市朝阳区xxx】
  订单金额：【498元】
  定金金额：【249元】
  请登录平台查看详情并及时处理订单。
  ```
- **重拨机制**：3次，间隔3分钟

#### 2. 短信通知
- **触发场景**：
  - 用户注册成功
  - 订单支付成功
  - 技师接单/拒单
  - 服务即将开始（提前1小时）
  - 提现到账
  - 积分即将过期（提前7天）
- **短信模板**需提前报备

#### 3. 站内消息
- **触发场景**：所有重要操作
- **消息类型**：
  - 系统通知：订单状态变更
  - 账户通知：积分变动、提现处理
  - 活动通知：平台活动、公告
- **展示位置**：
  - 首页消息中心（红点提示）
  - 个人中心消息列表

#### 4. 推送通知（Web Push）
- **触发场景**：实时重要消息
- **需用户授权**：首次访问时请求通知权限
- **内容**：订单状态变更、重要通知

### 通知内容规范

#### 用户端通知
| 场景 | 通知内容 | 通知渠道 |
|------|---------|---------|
| 注册成功 | 欢迎加入君悦SPA，您的邀请码：XXX | 短信+站内 |
| 支付成功 | 定金支付成功，等待技师接单 | 短信+站内+推送 |
| 技师接单 | 技师已接单，联系方式已开放 | 短信+站内+推送 |
| 技师拒单 | 技师拒单，定金已退还为积分 | 短信+站内+推送 |
| 服务提醒 | 您的服务将在1小时后开始 | 短信+站内+推送 |
| 积分到账 | 签到成功，获得X积分 | 站内 |
| 积分过期 | 您有X临时积分将在7天后过期 | 短信+站内 |
| 推荐收益 | 您推荐的用户消费成功，获得X元 | 站内 |

#### 技师端通知
| 场景 | 通知内容 | 通知渠道 |
|------|---------|---------|
| 新订单 | 您有新的订单，请及时处理 | 语音+短信+站内+推送 |
| 审核通过 | 资料审核通过，可开始接单 | 短信+站内 |
| 审核不通过 | 资料审核不通过，原因：XXX | 短信+站内 |
| 服务提醒 | 您的服务将在1小时后开始 | 短信+站内+推送 |
| 收益到账 | 订单完成，收益已到账 | 站内 |
| 提现到账 | 提现成功，请查收 | 短信+站内 |

## 📊 数据统计口径定义

### 核心指标定义

#### 用户相关指标
- **日活用户（DAU）**：当日至少登录一次的独立用户数
- **月活用户（MAU）**：当月至少登录一次的独立用户数
- **新增用户**：当日完成注册的用户数
- **用户留存率**：
  - 次日留存：注册后第2天登录的用户占比
  - 7日留存：注册后第7天登录的用户占比
  - 30日留存：注册后第30天登录的用户占比

#### 订单相关指标
- **订单量**：当日创建的订单总数（包含所有状态）
- **完成订单量**：当日状态为"已完成"的订单数
- **GMV（成交总额）**：完成订单的订单总额之和
- **客单价**：GMV / 完成订单量
- **订单完成率**：完成订单量 / 创建订单量 × 100%
- **技师接单率**：已接单订单 / 待接单订单 × 100%

#### 转化相关指标
- **注册转化率**：注册用户数 / 访问用户数 × 100%
- **下单转化率**：下单用户数 / 登录用户数 × 100%
- **支付转化率**：支付订单数 / 创建订单数 × 100%
- **复购率**：有2次及以上购买的用户数 / 总购买用户数 × 100%

#### 收益相关指标
- **平台收入**：定金收入 + 联系方式解锁收入
- **平台净收入**：平台收入 - 推荐佣金支出
- **技师收益**：尾款总和
- **用户推荐收益**：所有用户获得的推荐佣金总和
- **技师推荐收益**：所有技师获得的推荐分成总和

### 统计维度

#### 时间维度
- 实时（最近1小时）
- 今日（00:00-23:59）
- 昨日
- 最近7天
- 最近30天
- 本月（1日至今）
- 上月
- 自定义时间范围

#### 地域维度
- 按省份统计
- 按城市统计
- 按区域统计
- 热力图展示

#### 用户维度
- 按用户类型（新用户/老用户）
- 按用户等级（普通/VIP）
- 按注册渠道（直接注册/邀请注册）
- 按活跃度（活跃/流失/沉睡）

## 🛡️ 风控和安全策略

### 防刷单机制

#### 用户侧防刷单
- **限制规则**：
  - 同一用户24小时内最多创建5个订单
  - 同一用户7天内最多取消3个订单
  - 同一IP地址24小时内最多注册3个账号
  - 同一手机号只能注册1个账号
- **异常检测**：
  - 短时间内大量下单后取消
  - 频繁更换设备登录
  - 同一支付账号对应多个用户账号
- **处理措施**：
  - 轻度：验证码验证、限制下单
  - 中度：账号冻结24小时
  - 重度：永久封号

#### 技师侧防刷单
- **限制规则**：
  - 同一技师24小时内最多接单10个
  - 拒单率超过30%降低展示优先级
  - 同一设备只能注册1个技师账号
- **异常检测**：
  - 短时间内大量接单后取消
  - 与特定用户频繁交易
  - 评价异常（全部好评或全部差评）
- **处理措施**：
  - 人工审核交易记录
  - 暂停接单功能
  - 严重者永久封号

### 积分安全策略

#### 积分获取监控
- **异常行为**：
  - 多个账号同一设备签到
  - 签到时间过于规律（疑似脚本）
  - 短时间内大量积分变动
- **防护措施**：
  - 签到需要滑动验证码
  - 记录设备指纹
  - 异常积分冻结，需人工审核

#### 积分使用监控
- **异常行为**：
  - 积分在多个账号间转移（如果开放转赠功能）
  - 大额积分异常消费
  - 积分套现行为
- **防护措施**：
  - 积分变动全程记录
  - 大额积分使用需验证
  - 禁止积分转赠功能

### 支付安全

#### 定金支付安全
- **SemiPay安全措施**：
  - 收款码定期轮换
  - Telegram实时通知监控
  - 异常金额人工确认
- **订单确认流程**：
  - 系统自动识别收款
  - 金额、订单号双重校验
  - 超时未确认人工介入

#### 提现安全
- **身份验证**：
  - 绑定真实姓名
  - 手机号验证
  - 大额提现人脸识别
- **风控规则**：
  - 单日提现次数限制（1次）
  - 单次提现金额限制（最高5000元）
  - 新注册用户30天后才能提现
  - 异常账号冻结提现功能
- **审核机制**：
  - 100-500元：自动审核
  - 500-2000元：人工审核
  - 2000元以上：加强审核

### 隐私保护

#### 联系方式保护
- **默认隐藏**：
  - 所有联系方式默认加密存储
  - 未解锁前显示为"***"
  - 仅在特定条件下开放
- **临时开放机制**：
  - 技师接单后开放（订单期间）
  - 服务完成后自动隐藏
  - 不可截图或复制（前端限制）
- **永久解锁机制**：
  - 支付99积分后永久解锁
  - 记录解锁时间和来源
  - 技师端显示被解锁次数

#### 个人信息保护
- **数据加密**：
  - 敏感信息数据库加密存储
  - 传输过程HTTPS加密
  - 日志脱敏处理
- **权限控制**：
  - 管理员按需分配权限
  - 操作日志全程记录
  - 定期审计访问记录

## ⚖️ 用户协议与争议解决

### 用户服务协议要点

#### 账号注册协议
- 用户需提供真实信息注册
- 一个手机号只能注册一个账号
- 禁止账号买卖、转让、共享
- 违规行为将被封号

#### 交易规则协议
- **"只换不退"政策**：
  - 支付定金后，技师拒单退还积分，不退现金
  - 积分可用于重新下单或解锁联系方式
  - 特殊情况由客服判定是否例外处理
- **服务质量承诺**：
  - 平台不直接提供服务，仅作为撮合平台
  - 技师信息由技师本人提供，平台审核真实性
  - 服务纠纷由双方协商或平台介入调解

#### 积分规则协议
- 积分不可提现、不可转赠
- 临时积分有效期60天，到期清零
- 正式积分永久有效
- 平台有权取消异常获得的积分

### 技师服务协议要点

#### 入驻协议
- 提供真实身份信息和资料
- 保证提供的服务符合平台标准
- 遵守平台管理规则
- 及时响应订单（10分钟内）

#### 收益协议
- 订单收益按平台规则分配
- 尾款由用户现场支付，平台不代收
- 推荐收益定期结算
- 提现需通过平台审核

#### 违规处理
- 资料造假：永久封号
- 服务质量问题：警告、暂停接单、封号
- 多次拒单/爽约：降低展示、暂停接单
- 私下交易引导：封号

### 争议解决流程

#### 第一步：协商解决
- 用户和技师先行协商
- 平台提供沟通渠道
- 建议24小时内达成一致

#### 第二步：平台介入调解
- 任何一方可申请平台介入
- 提交申诉和证据材料
- 客服48小时内调查处理
- 给出调解方案

#### 第三步：平台裁决
- 协商调解无果，平台作出最终裁决
- 根据证据和规则判定责任
- 执行退款、补偿等处理
- 裁决结果为最终结果

#### 第四步：法律途径
- 对平台裁决不服，可寻求法律途径
- 平台配合提供交易记录等证据
- 以最终司法判决为准

## 🎨 技术架构说明

### 前端技术栈
- **框架**：Next.js 14 (App Router)
- **语言**：TypeScript (strict mode)
- **样式**：TailwindCSS + CSS Modules
- **状态管理**：Zustand
- **表单**：React Hook Form + Zod验证
- **HTTP请求**：Axios
- **地图**：腾讯地图API
- **图片上传**：阿里云OSS / 腾讯云COS

### 后端技术栈
- **框架**：Next.js 14 API Routes
- **语言**：TypeScript (strict mode)
- **ORM**：Prisma
- **数据库**：PostgreSQL 14+
- **缓存**：Redis 6+
- **认证**：NextAuth.js
- **支付**：SemiPay集成
- **语音通知**：阿里云语音服务

### 部署方案
- **前端部署**：Vercel / 自建服务器
- **数据库**：
  - 开发环境：本地PostgreSQL
  - 生产环境：云数据库（阿里云RDS / 腾讯云数据库）
- **Redis缓存**：
  - 开发环境：本地Redis
  - 生产环境：云Redis（阿里云 / 腾讯云）
- **文件存储**：阿里云OSS / 腾讯云COS
- **CDN加速**：阿里云CDN / 腾讯云CDN

### 性能要求
- API响应时间 < 500ms
- 页面首屏加载 < 3秒
- 图片加载优化（懒加载、WebP格式）
- 数据库查询优化（索引、缓存）
- 并发支持：500+ 在线用户

### 安全要求
- HTTPS全站加密
- SQL注入防护
- XSS攻击防护
- CSRF攻击防护
- 敏感数据加密存储
- 定期安全审计

## 📱 移动端适配说明

### 响应式设计
- **断点设置**：
  - Mobile: < 640px
  - Tablet: 640px - 1024px
  - Desktop: > 1024px
- **适配方案**：移动优先（Mobile First）
- **触摸优化**：按钮最小44x44px，间距合理

### PWA支持
- **渐进式Web应用**：
  - 支持添加到主屏幕
  - 离线缓存基础页面
  - 推送通知功能
  - Service Worker
- **应用图标**：提供多尺寸图标
- **启动画面**：自定义Splash Screen

### 原生APP计划（可选）
- **第一阶段**：PWA满足基本需求
- **第二阶段**：如需要可开发原生APP
  - iOS: Swift + SwiftUI
  - Android: Kotlin + Jetpack Compose
  - 或使用React Native跨平台开发

---

*本文档版本：v3.0*  
*最后更新：2025年10月4日*  
*文档状态：已完善优化*
