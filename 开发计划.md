# 君悦SPA - 开发计划

> **项目名称**: 君悦SPA技师预约服务平台  
> **开发模式**: 单人全栈开发  
> **技术栈**: Next.js 14 + PostgreSQL + Prisma + Tailwind CSS  
> **预计工期**: 6-8周  
> **开始日期**: 2025-10-08  
> **目标上线**: 2025-11-25

---

## 📋 目录

- [项目概述](#项目概述)
- [开发阶段](#开发阶段)
- [详细任务清单](#详细任务清单)
- [技术难点预判](#技术难点预判)
- [风险控制](#风险控制)
- [质量保证](#质量保证)

---

## 🎯 项目概述

### 项目规模
- **前端页面**: 约50个页面（45-50个独立页面 + 4个共用页面）
- **后端API**: 143个接口（用户端37 + 技师端30 + 代理端10 + 管理端61 + 通用5）
- **数据表**: 36张表（用户7 + 技师7 + 订单4 + 服务3 + 邀请分佣6 + 财务4 + 系统5）
- **核心功能**: 用户端 + 技师端 + 代理端 + 管理端
- **UI组件**: 35个定制组件(基于21st.dev)

### 页面共用策略
**完全共用页面（4个）**：
- `/notifications` - 通知列表（用户/技师/代理共用）
- `/profile` - 个人资料（用户/技师/代理共用）
- `/withdrawals` - 提现记录（技师/代理共用）
- `/withdrawals/apply` - 提现申请（技师/代理共用）

**组件级复用**：
- 订单卡片、收益列表、表单组件等在多端复用

### 开发优先级
- **P0** (核心功能,必须有): 用户浏览技师 → 下单支付 → 技师接单
- **P1** (重要功能,应该有): 积分系统、评价系统、技师管理
- **P2** (增值功能,最好有): 邀请分佣、数据分析、高级筛选
- **P3** (锦上添花,可延后): 社交功能、智能推荐、数据导出

---

## 📅 开发阶段

### 阶段划分

| 阶段 | 名称 | 预计时间 | 核心产出 | 完成标准 |
|-----|------|---------|---------|---------|
| **第1阶段** | 环境搭建 | 3天 | 项目框架、数据库 | 本地开发环境可运行 |
| **第2阶段** | 数据库设计 | 2天 | Prisma Schema | 数据库表创建成功 |
| **第3阶段** | 用户端开发 | 14天 | 用户端完整功能 | 用户可完成下单流程 |
| **第4阶段** | 技师端开发 | 10天 | 技师端完整功能 | 技师可接单和管理订单 |
| **第5阶段** | 管理端开发 | 10天 | 管理端完整功能 | 管理员可管理平台 |
| **第6阶段** | 代理端开发 | 3天 | 代理端完整功能 | 代理可查看收益 |
| **第7阶段** | 支付集成 | 3天 | SemiPay集成 | 支付流程完整 |
| **第8阶段** | 高级功能 | 7天 | 地图、语音、分佣 | 高级功能可用 |
| **第9阶段** | 测试优化 | 7天 | Bug修复、性能优化 | 功能稳定可上线 |
| **第10阶段** | 部署上线 | 2天 | 生产环境部署 | 正式上线运行 |

**总计**: 61天 ≈ **9周**

---

## ✅ 详细任务清单

### 📦 第1阶段：环境搭建 (Day 1-3)

#### Day 1: 项目初始化
- [ ] 初始化Next.js 14项目
  ```bash
  npx create-next-app@latest junyue-spa --typescript --tailwind --app --src-dir
  ```
- [ ] 配置TypeScript strict模式
- [ ] 配置Tailwind CSS + 主题色
- [ ] 安装shadcn/ui CLI
  ```bash
  npx shadcn@latest init
  ```
- [ ] 创建项目目录结构
  ```
  src/
  ├── app/
  │   ├── (user)/      # 用户端路由组
  │   ├── (therapist)/ # 技师端路由组
  │   ├── (admin)/     # 管理端路由组
  │   └── api/         # API路由
  ├── components/      # 共享组件
  │   ├── ui/          # shadcn组件
  │   ├── user/        # 用户端组件
  │   ├── therapist/   # 技师端组件
  │   └── admin/       # 管理端组件
  ├── lib/             # 工具函数
  ├── hooks/           # 自定义Hooks
  ├── types/           # TypeScript类型
  └── constants/       # 常量配置
  ```

#### Day 2: 核心依赖安装
- [ ] 安装Prisma
  ```bash
  npm install prisma @prisma/client
  npm install -D prisma
  ```
- [ ] 安装认证库
  ```bash
  npm install next-auth@beta bcryptjs
  npm install -D @types/bcryptjs
  ```
- [ ] 安装表单库
  ```bash
  npm install react-hook-form zod @hookform/resolvers
  ```
- [ ] 安装状态管理
  ```bash
  npm install zustand
  ```
- [ ] 安装HTTP请求
  ```bash
  npm install axios
  ```
- [ ] 安装动画库
  ```bash
  npm install framer-motion
  ```
- [ ] 安装表格组件
  ```bash
  npm install @tanstack/react-table
  ```
- [ ] 安装图表库
  ```bash
  npm install recharts
  ```
- [ ] 安装日期库
  ```bash
  npm install date-fns react-day-picker
  ```
- [ ] 安装UI组件(21st.dev相关)
  ```bash
  npx shadcn@latest add button card input calendar
  npx shadcn@latest add dialog toast tabs badge
  ```

#### Day 3: 开发工具配置
- [ ] 配置ESLint
- [ ] 配置Prettier
- [ ] 配置Husky(Git hooks)
  ```bash
  npm install -D husky lint-staged
  npx husky install
  ```
- [ ] 配置环境变量
  ```env
  DATABASE_URL="postgresql://user:password@localhost:5432/junyue_spa"
  DIRECT_URL="postgresql://user:password@localhost:5432/junyue_spa"
  NEXTAUTH_SECRET="your-secret-key"
  NEXTAUTH_URL="http://localhost:3000"
  ```
- [ ] 测试运行项目
  ```bash
  npm run dev
  ```

**验收标准**: 
- ✅ 项目可以正常启动
- ✅ 热更新正常工作
- ✅ 代码格式化正常
- ✅ Git提交检查正常

---

### 🗄️ 第2阶段：数据库设计 (Day 4-5)

#### Day 4: Prisma Schema编写
- [ ] 初始化Prisma
  ```bash
  npx prisma init
  ```
- [ ] 编写完整Prisma Schema(参考数据库设计文档)
  - [ ] 用户相关表(7张)
  - [ ] 技师相关表(7张)
  - [ ] 订单相关表(4张)
  - [ ] 服务相关表(3张)
  - [ ] 邀请分佣表(5张)
  - [ ] 财务相关表(4张)
  - [ ] 系统相关表(5张)
- [ ] 配置数据库连接
- [ ] 运行迁移
  ```bash
  npx prisma migrate dev --name init
  ```
- [ ] 生成Prisma Client
  ```bash
  npx prisma generate
  ```

#### Day 5: 数据库初始化
- [ ] 创建seed脚本填充测试数据
  - [ ] 3个测试用户
  - [ ] 10个测试技师
  - [ ] 3个服务项目(498/598/698)
  - [ ] 10个城市和区域
  - [ ] 1个超级管理员
- [ ] 运行seed
  ```bash
  npx prisma db seed
  ```
- [ ] 使用Prisma Studio验证数据
  ```bash
  npx prisma studio
  ```
- [ ] 创建数据库工具函数
  - [ ] `lib/prisma.ts` - Prisma单例
  - [ ] `lib/db/users.ts` - 用户数据操作
  - [ ] `lib/db/therapists.ts` - 技师数据操作
  - [ ] `lib/db/orders.ts` - 订单数据操作

**验收标准**:
- ✅ 数据库迁移成功
- ✅ 测试数据填充成功
- ✅ Prisma Studio可以查看数据
- ✅ 数据表关系正确

---

### 👤 第3阶段：用户端开发 (Day 6-19, 共14天)

#### Week 1: P0核心功能 (Day 6-12)

##### Day 6: 登录注册
- [ ] 创建登录页面 `/app/(user)/login/page.tsx`
  - [ ] 使用Gaming Login组件(21st.dev)
  - [ ] 手机号+密码登录
  - [ ] 验证码登录(先占位)
- [ ] 创建注册页面 `/app/(user)/register/page.tsx`
  - [ ] 手机号注册
  - [ ] 邀请码输入(可选)
- [ ] 实现登录API
  - [ ] `POST /api/user/auth/login`
  - [ ] `POST /api/user/auth/register`
  - [ ] 使用NextAuth.js
  - [ ] 生成JWT Token
- [ ] 实现登出API
  - [ ] `POST /api/user/auth/logout`

##### Day 7-8: 技师列表页
- [ ] 创建技师列表页 `/app/(user)/therapists/page.tsx`
  - [ ] 使用Gallery Hover Carousel组件
  - [ ] 技师卡片展示(头像、昵称、年龄、身高、评分)
  - [ ] 分页加载
- [ ] 实现筛选功能
  - [ ] 城市筛选下拉框(Combobox组件)
  - [ ] 区域筛选
  - [ ] 身高、体重、年龄范围滑块
  - [ ] 在线状态筛选
  - [ ] 新技师/推荐技师筛选
- [ ] 实现搜索功能
  - [ ] 搜索框(Search Bar组件)
  - [ ] 关键词搜索
- [ ] 实现排序功能
  - [ ] 按评分排序
  - [ ] 按订单量排序
  - [ ] 按注册时间排序
- [ ] 实现技师列表API
  - [ ] `GET /api/user/therapists`
  - [ ] 支持分页、筛选、排序、搜索
  - [ ] 优化SQL查询性能

##### Day 9-10: 技师详情页
- [ ] 创建技师详情页 `/app/(user)/therapists/[id]/page.tsx`
  - [ ] 使用3D Carousel展示照片
  - [ ] 视频播放器
  - [ ] 基本信息展示
  - [ ] 个人介绍
  - [ ] 服务特色标签(Badge组件)
- [ ] 可预约时间展示
  - [ ] 使用Calendar组件
  - [ ] 时间段选择(Appointment Picker)
- [ ] 用户评价展示
  - [ ] 使用Client Reviews组件
  - [ ] 评分统计
  - [ ] 分页评价列表
- [ ] 联系方式解锁
  - [ ] 99积分解锁按钮
  - [ ] 解锁确认弹窗(Modal组件)
- [ ] 收藏功能
  - [ ] 收藏按钮
  - [ ] 收藏状态切换
- [ ] 实现API
  - [ ] `GET /api/user/therapists/:id`
  - [ ] `GET /api/user/therapists/:id/reviews`
  - [ ] `GET /api/user/therapists/:id/schedules`
  - [ ] `POST /api/user/therapists/:id/unlock-contact`
  - [ ] `POST /api/user/favorites`

##### Day 11-12: 预约下单流程
- [ ] 创建下单页面 `/app/(user)/order/create/page.tsx`
  - [ ] 服务项目选择(3档套餐卡片)
  - [ ] 日期时间选择(Calendar + 时间段)
  - [ ] 服务方式选择(Radio Group)
  - [ ] 地址输入(Input + 地图选点-先占位)
  - [ ] 联系信息填写
  - [ ] 积分抵扣选择
    - [ ] 显示可用积分
    - [ ] 智能推荐抵扣方案
    - [ ] 手动调整抵扣金额
  - [ ] 实时计算总价
  - [ ] "只换不退"政策确认(Checkbox)
- [ ] 创建订单确认页
  - [ ] 订单详情展示
  - [ ] 支付按钮
- [ ] 实现API
  - [ ] `GET /api/user/services` - 服务项目列表
  - [ ] `POST /api/user/orders/create` - 创建订单
  - [ ] `POST /api/user/orders/:id/pay` - 支付(先返回占位URL)
- [ ] 创建支付页面(占位)
  - [ ] 显示支付二维码(先用假图)
  - [ ] 支付成功跳转

#### Week 2: P1重要功能 (Day 13-19)

##### Day 13: 订单管理
- [ ] 创建订单列表页 `/app/(user)/orders/page.tsx`
  - [ ] 使用Tabs组件(全部/待支付/待接单/已接单/已完成)
  - [ ] 订单卡片展示
  - [ ] 订单状态Badge
  - [ ] 分页加载
- [ ] 创建订单详情页 `/app/(user)/orders/[id]/page.tsx`
  - [ ] 使用Order Tracking时间轴
  - [ ] 订单信息完整展示
  - [ ] 技师联系方式(接单后显示)
  - [ ] 操作按钮(取消订单/投诉/评价)
  - [ ] 倒计时组件(待接单状态)
- [ ] 实现API
  - [ ] `GET /api/user/orders` - 订单列表
  - [ ] `GET /api/user/orders/:id` - 订单详情
  - [ ] `POST /api/user/orders/:id/cancel` - 取消订单
  - [ ] `POST /api/user/orders/:id/complain` - 投诉申诉

##### Day 14: 积分系统
- [ ] 创建签到页面 `/app/(user)/points/sign-in/page.tsx`
  - [ ] 签到按钮
  - [ ] 签到日历显示
  - [ ] 连续签到天数
  - [ ] 本月累计积分进度条
  - [ ] 签到规则说明
- [ ] 创建积分记录页 `/app/(user)/points/records/page.tsx`
  - [ ] Tabs区分正式积分/临时积分
  - [ ] 积分变动列表
  - [ ] 余额显示
- [ ] 实现积分逻辑
  - [ ] 签到规则计算
    - [ ] 阶梯递增(2/3/3/4积分)
    - [ ] 周奖励计算
    - [ ] 月度上限90积分
  - [ ] 临时积分过期检查
- [ ] 实现API
  - [ ] `POST /api/user/points/sign-in` - 每日签到
  - [ ] `GET /api/user/points/records` - 积分记录
  - [ ] `GET /api/user/points/balance` - 积分余额
  - [ ] `GET /api/user/points/sign-in-calendar` - 签到日历

##### Day 15: 评价系统
- [ ] 创建评价页面 `/app/(user)/reviews/create/page.tsx`
  - [ ] 使用Rating Stars组件
  - [ ] 评分选择(1-5星)
  - [ ] 评价内容输入
  - [ ] 提交按钮
- [ ] 我的评价列表 `/app/(user)/reviews/page.tsx`
  - [ ] 评价卡片展示
  - [ ] 审核状态显示
  - [ ] 删除评价功能
- [ ] 实现API
  - [ ] `POST /api/user/reviews` - 提交评价
  - [ ] `GET /api/user/reviews` - 我的评价
  - [ ] `DELETE /api/user/reviews/:id` - 删除评价

##### Day 16: 个人中心
- [ ] 创建个人中心页 `/app/(user)/profile/page.tsx`
  - [ ] 使用Profile Card组件
  - [ ] 使用Statistics Cards展示数据
    - [ ] 累计消费
    - [ ] 预约次数
    - [ ] 积分余额
    - [ ] 推荐收益
  - [ ] 个人信息编辑
  - [ ] 修改密码
  - [ ] 我的邀请码
- [ ] 我的收藏页 `/app/(user)/favorites/page.tsx`
  - [ ] 收藏技师列表
  - [ ] 取消收藏
- [ ] 推荐收益页 `/app/(user)/earnings/page.tsx`
  - [ ] 收益列表
  - [ ] 收益统计
- [ ] 实现API
  - [ ] `GET /api/user/profile` - 个人信息
  - [ ] `PUT /api/user/profile` - 更新信息
  - [ ] `POST /api/user/profile/change-password` - 修改密码
  - [ ] `GET /api/user/favorites` - 我的收藏
  - [ ] `DELETE /api/user/favorites/:id` - 取消收藏
  - [ ] `GET /api/user/earnings` - 推荐收益

##### Day 17: 首页和导航
- [ ] 创建首页 `/app/(user)/page.tsx`
  - [ ] 使用Hero Section组件
  - [ ] 服务项目展示(3个卡片)
  - [ ] 推荐技师轮播
  - [ ] 新技师展示
  - [ ] 公告栏
- [ ] 创建底部导航栏
  - [ ] 使用LumaBar/Glass Dock组件
  - [ ] 5个Tab(首页/技师/订单/积分/我的)
  - [ ] 活动指示器
- [ ] 创建顶部导航栏
  - [ ] Logo
  - [ ] 搜索框
  - [ ] 通知图标
  - [ ] 用户头像
- [ ] 实现API
  - [ ] `GET /api/user/therapists/featured` - 推荐技师
  - [ ] `GET /api/user/therapists/new` - 新技师
  - [ ] `GET /api/announcements` - 公告列表

##### Day 18: 通知系统
- [ ] 创建通知列表页 `/app/(user)/notifications/page.tsx`
  - [ ] 通知卡片
  - [ ] 未读标记
  - [ ] 点击标记已读
  - [ ] 分页加载
- [ ] 实现Toast通知
  - [ ] 使用Toast组件
  - [ ] 成功/失败/警告/信息
  - [ ] 自动消失
- [ ] 实现API
  - [ ] `GET /api/notifications` - 通知列表
  - [ ] `POST /api/notifications/:id/read` - 标记已读
  - [ ] `GET /api/notifications/unread-count` - 未读数量

##### Day 19: 用户端联调测试
- [ ] 完整流程测试
  - [ ] 注册→登录→浏览技师→下单→查看订单
  - [ ] 签到→使用积分→评价订单
  - [ ] 收藏技师→查看收益
- [ ] 修复发现的Bug
- [ ] 优化用户体验
  - [ ] Loading状态
  - [ ] 错误提示
  - [ ] 空状态展示(Empty State组件)
- [ ] 响应式适配检查(手机/平板/桌面)

**第3阶段验收标准**:
- ✅ 用户可以完整走通下单流程
- ✅ 积分系统正常运作
- ✅ 评价系统正常提交
- ✅ 移动端体验良好

---

### 💆 第4阶段：技师端开发 (Day 20-29, 共10天)

#### Day 20-21: 认证和资料管理
- [ ] 创建技师登录页 `/app/(therapist)/login/page.tsx`
  - [ ] 复用用户端登录组件
  - [ ] 独立的认证逻辑
- [ ] 创建技师注册页 `/app/(therapist)/register/page.tsx`
  - [ ] 邀请码必填
  - [ ] 基本信息填写
- [ ] 创建资料完善页 `/app/(therapist)/profile/edit/page.tsx`
  - [ ] 基本信息表单
  - [ ] 照片上传(File Upload组件)
    - [ ] 拖拽上传
    - [ ] 至少3张照片
    - [ ] 图片预览
    - [ ] 删除照片
  - [ ] 视频上传
    - [ ] 文件大小限制
    - [ ] 上传进度显示
  - [ ] 个人介绍
  - [ ] 服务区域选择
  - [ ] 联系方式填写
- [ ] 创建审核状态页 `/app/(therapist)/audit/page.tsx`
  - [ ] 待审核提示
  - [ ] 审核不通过原因显示
  - [ ] 重新提交按钮
- [ ] 实现API
  - [ ] `POST /api/therapist/auth/register` - 技师注册
  - [ ] `POST /api/therapist/auth/login` - 技师登录
  - [ ] `GET /api/therapist/profile` - 获取资料
  - [ ] `PUT /api/therapist/profile/basic` - 更新资料
  - [ ] `POST /api/therapist/profile/photos` - 上传照片
  - [ ] `DELETE /api/therapist/profile/photos/:id` - 删除照片
  - [ ] `POST /api/therapist/profile/videos` - 上传视频
  - [ ] `POST /api/therapist/profile/submit-audit` - 提交审核
- [ ] 实现文件上传API
  - [ ] `POST /api/upload` - 通用文件上传
  - [ ] 对接腾讯云COS(或本地存储)

#### Day 22-24: 订单管理
- [ ] 创建订单列表页 `/app/(therapist)/orders/page.tsx`
  - [ ] 使用Tabs(待响应/已接单/已完成/历史)
  - [ ] 订单卡片
  - [ ] 快速操作按钮
- [ ] 创建待响应订单页 `/app/(therapist)/orders/pending/page.tsx`
  - [ ] 订单详情展示
  - [ ] 倒计时组件(10分钟)
  - [ ] 接单按钮(大)
  - [ ] 拒单按钮+原因输入
  - [ ] 自动刷新
- [ ] 创建订单详情页 `/app/(therapist)/orders/[id]/page.tsx`
  - [ ] 完整订单信息
  - [ ] 客户联系方式(接单后)
  - [ ] 状态时间轴
  - [ ] 操作按钮
    - [ ] 开始服务
    - [ ] 完成服务
- [ ] 创建今日订单页 `/app/(therapist)/orders/today/page.tsx`
  - [ ] 今日行程展示
  - [ ] 时间轴视图
  - [ ] 快速导航
- [ ] 实现API
  - [ ] `GET /api/therapist/orders/pending` - 待响应订单
  - [ ] `GET /api/therapist/orders` - 订单列表
  - [ ] `GET /api/therapist/orders/:id` - 订单详情
  - [ ] `POST /api/therapist/orders/:id/accept` - 接单
  - [ ] `POST /api/therapist/orders/:id/reject` - 拒单
  - [ ] `POST /api/therapist/orders/:id/start` - 开始服务
  - [ ] `POST /api/therapist/orders/:id/complete` - 完成服务
  - [ ] `GET /api/therapist/orders/today` - 今日订单
  - [ ] `GET /api/therapist/orders/statistics` - 订单统计

#### Day 25: 时间管理
- [ ] 创建时间表管理页 `/app/(therapist)/schedules/page.tsx`
  - [ ] 使用Calendar组件
  - [ ] 时间段列表
  - [ ] 添加时间段弹窗
    - [ ] 日期选择
    - [ ] 开始结束时间
    - [ ] 是否每天重复
  - [ ] 批量设置功能
  - [ ] 删除时间段
- [ ] 在线状态切换
  - [ ] Switch Toggle组件
  - [ ] 实时更新状态
- [ ] 实现API
  - [ ] `GET /api/therapist/schedules` - 获取时间表
  - [ ] `POST /api/therapist/schedules` - 添加时间段
  - [ ] `DELETE /api/therapist/schedules/:id` - 删除时间段
  - [ ] `POST /api/therapist/schedules/batch` - 批量设置
  - [ ] `POST /api/therapist/status/toggle` - 切换在线状态

#### Day 26-27: 收益管理
- [ ] 创建收益概览页 `/app/(therapist)/earnings/page.tsx`
  - [ ] 使用Statistics Cards
    - [ ] 累计收益
    - [ ] 可提现余额
    - [ ] 待结算金额
    - [ ] 推荐收益
  - [ ] 收益趋势图(Recharts)
- [ ] 创建收益明细页 `/app/(therapist)/earnings/records/page.tsx`
  - [ ] Tabs(订单收益/推荐收益)
  - [ ] 收益列表
  - [ ] 筛选功能
- [ ] 创建提现页 `/app/(therapist)/withdrawals/page.tsx`
  - [ ] 提现表单
    - [ ] 提现金额输入
    - [ ] 提现方式选择(支付宝/微信/银行卡)
    - [ ] 收款账号
    - [ ] 收款人姓名
  - [ ] 提现记录列表
    - [ ] 状态Badge
    - [ ] 处理时间
- [ ] 创建推广页 `/app/(therapist)/referral/page.tsx`
  - [ ] 邀请码展示(可复制)
  - [ ] 邀请二维码(qrcode.react)
  - [ ] 下级技师列表
  - [ ] 推广收益明细
- [ ] 实现API
  - [ ] `GET /api/therapist/earnings/overview` - 收益概览
  - [ ] `GET /api/therapist/earnings/records` - 收益明细
  - [ ] `POST /api/therapist/withdrawals` - 申请提现
  - [ ] `GET /api/therapist/withdrawals` - 提现记录

#### Day 28: 技师个人中心
- [ ] 创建个人中心页 `/app/(therapist)/profile/page.tsx`
  - [ ] 使用Profile Card
  - [ ] 绩效数据展示
  - [ ] 评分展示
  - [ ] 编辑资料入口
  - [ ] 设置入口
- [ ] 创建设置页 `/app/(therapist)/settings/page.tsx`
  - [ ] 修改密码
  - [ ] 通知设置
  - [ ] 隐私设置

#### Day 29: 技师端联调测试
- [ ] 完整流程测试
  - [ ] 注册→审核→接单→完成→提现
  - [ ] 时间管理→在线状态切换
  - [ ] 查看收益→申请提现
- [ ] 修复Bug
- [ ] 优化体验
- [ ] 响应式检查

**第4阶段验收标准**:
- ✅ 技师可以正常接单和管理订单
- ✅ 时间表管理正常
- ✅ 收益统计准确
- ✅ 提现流程完整

---

### 🔧 第5阶段：管理端开发 (Day 30-39, 共10天)

#### Day 30-31: 管理员认证和首页
- [ ] 创建管理员登录页 `/app/(admin)/login/page.tsx`
  - [ ] 独立的管理员登录界面
  - [ ] 用户名+密码登录
- [ ] 创建管理端布局
  - [ ] 侧边栏导航
  - [ ] 顶部导航栏
  - [ ] 面包屑导航
- [ ] 创建数据看板页 `/app/(admin)/dashboard/page.tsx`
  - [ ] 使用Statistics Cards展示核心指标
    - [ ] 日活用户
    - [ ] 订单量
    - [ ] GMV
    - [ ] 转化率
  - [ ] 趋势图表(Recharts)
    - [ ] 用户增长曲线
    - [ ] 订单趋势
    - [ ] 收入趋势
  - [ ] 地域分布图
    - [ ] 用户城市分布饼图
    - [ ] 技师城市分布饼图
  - [ ] 热门服务排行
  - [ ] 技师排行榜
- [ ] 实现API
  - [ ] `POST /api/admin/auth/login` - 管理员登录
  - [ ] `GET /api/admin/dashboard/metrics` - 核心指标
  - [ ] `GET /api/admin/dashboard/trends` - 趋势数据
  - [ ] `GET /api/admin/dashboard/geo-distribution` - 地域分布
  - [ ] `GET /api/admin/dashboard/popular-services` - 热门服务
  - [ ] `GET /api/admin/dashboard/top-therapists` - 技师排行

#### Day 32-33: 用户管理
- [ ] 创建用户列表页 `/app/(admin)/users/page.tsx`
  - [ ] 使用TanStack Table
  - [ ] 多列筛选
  - [ ] 全局搜索
  - [ ] 排序功能
  - [ ] 分页器(Pagination组件)
  - [ ] 批量操作
    - [ ] 批量发送积分
    - [ ] 批量封禁
  - [ ] 快速操作按钮
    - [ ] 查看详情
    - [ ] 发放积分
    - [ ] 封禁/解封
- [ ] 创建用户详情页 `/app/(admin)/users/[id]/page.tsx`
  - [ ] 用户画像
  - [ ] 订单历史
  - [ ] 积分记录
  - [ ] 推荐关系
  - [ ] 操作日志
- [ ] 实现API
  - [ ] `GET /api/admin/users` - 用户列表
  - [ ] `GET /api/admin/users/:id` - 用户详情
  - [ ] `POST /api/admin/users/:id/grant-points` - 发放积分
  - [ ] `POST /api/admin/users/:id/ban` - 封禁用户
  - [ ] `POST /api/admin/users/:id/unban` - 解封用户
  - [ ] `POST /api/admin/users/batch` - 批量操作
  - [ ] `GET /api/admin/users/export` - 导出用户

#### Day 34-35: 技师管理
- [ ] 创建技师列表页 `/app/(admin)/therapists/page.tsx`
  - [ ] 使用TanStack Table
  - [ ] 多维度筛选(状态/城市/评分)
  - [ ] 搜索功能
  - [ ] 排序功能
  - [ ] 快速操作
    - [ ] 审核通过/拒绝
    - [ ] 设为推荐
    - [ ] 封禁/解封
- [ ] 创建待审核技师页 `/app/(admin)/therapists/pending/page.tsx`
  - [ ] 待审核技师列表
  - [ ] 照片查看器
  - [ ] 视频播放
  - [ ] 审核按钮(通过/拒绝+原因)
- [ ] 创建技师详情页 `/app/(admin)/therapists/[id]/page.tsx`
  - [ ] 完整资料展示
  - [ ] 绩效数据
  - [ ] 订单历史
  - [ ] 评价列表
  - [ ] 推广数据
- [ ] 实现API
  - [ ] `GET /api/admin/therapists` - 技师列表
  - [ ] `GET /api/admin/therapists/pending` - 待审核列表
  - [ ] `GET /api/admin/therapists/:id` - 技师详情
  - [ ] `POST /api/admin/therapists/:id/approve` - 审核通过
  - [ ] `POST /api/admin/therapists/:id/reject` - 审核拒绝
  - [ ] `POST /api/admin/therapists/:id/ban` - 封禁技师
  - [ ] `POST /api/admin/therapists/:id/feature` - 设为推荐
  - [ ] `GET /api/admin/therapists/:id/performance` - 绩效数据

#### Day 36-37: 订单管理
- [ ] 创建订单列表页 `/app/(admin)/orders/page.tsx`
  - [ ] 使用TanStack Table
  - [ ] 多条件筛选
  - [ ] 订单号搜索
  - [ ] 导出功能
- [ ] 创建订单详情页 `/app/(admin)/orders/[id]/page.tsx`
  - [ ] 完整订单信息
  - [ ] 状态时间轴
  - [ ] 用户和技师信息
  - [ ] 操作按钮(手动退款)
- [ ] 创建异常订单页 `/app/(admin)/orders/abnormal/page.tsx`
  - [ ] 超时未接单
  - [ ] 异常退款
  - [ ] 投诉订单
- [ ] 创建投诉管理页 `/app/(admin)/complaints/page.tsx`
  - [ ] 投诉列表
  - [ ] 处理投诉弹窗
  - [ ] 处理结果记录
- [ ] 实现API
  - [ ] `GET /api/admin/orders` - 订单列表
  - [ ] `GET /api/admin/orders/:id` - 订单详情
  - [ ] `GET /api/admin/orders/abnormal` - 异常订单
  - [ ] `POST /api/admin/orders/:id/refund` - 手动退款
  - [ ] `GET /api/admin/orders/statistics` - 订单统计
  - [ ] `GET /api/admin/complaints` - 投诉列表
  - [ ] `POST /api/admin/complaints/:id/resolve` - 处理投诉

#### Day 38: 财务管理
- [ ] 创建提现管理页 `/app/(admin)/withdrawals/page.tsx`
  - [ ] 提现列表(TanStack Table)
  - [ ] 状态筛选
  - [ ] 审核操作
    - [ ] 审核通过
    - [ ] 拒绝提现
    - [ ] 确认转账
  - [ ] 批量导出功能
- [ ] 创建财务报表页 `/app/(admin)/finance/report/page.tsx`
  - [ ] 时间范围选择
  - [ ] 收入统计(定金/解锁)
  - [ ] 支出统计(推荐佣金/提现)
  - [ ] 利润计算
  - [ ] 图表展示(Recharts)
- [ ] 实现API
  - [ ] `GET /api/admin/withdrawals` - 提现列表
  - [ ] `POST /api/admin/withdrawals/:id/approve` - 审核通过
  - [ ] `POST /api/admin/withdrawals/:id/reject` - 拒绝提现
  - [ ] `POST /api/admin/withdrawals/:id/complete` - 确认转账
  - [ ] `GET /api/admin/withdrawals/export` - 导出提现
  - [ ] `GET /api/admin/finance/report` - 财务报表

#### Day 39: 系统管理
- [ ] 创建公告管理页 `/app/(admin)/announcements/page.tsx`
  - [ ] 公告列表
  - [ ] 发布公告表单
  - [ ] 编辑/删除公告
- [ ] 创建留言管理页 `/app/(admin)/feedbacks/page.tsx`
  - [ ] 留言列表
  - [ ] 回复留言
  - [ ] 关闭留言
- [ ] 创建评价审核页 `/app/(admin)/reviews/pending/page.tsx`
  - [ ] 待审核评价列表
  - [ ] 审核通过/拒绝
  - [ ] 设置是否显示
- [ ] 创建代理商管理页 `/app/(admin)/agents/page.tsx`
  - [ ] 代理商列表
  - [ ] 添加代理商
  - [ ] 设置佣金比例
  - [ ] 查看推广数据
- [ ] 创建系统配置页 `/app/(admin)/settings/page.tsx`
  - [ ] 分佣比例设置
  - [ ] 系统参数配置
- [ ] 实现API
  - [ ] `GET /api/admin/announcements` - 公告列表
  - [ ] `POST /api/admin/announcements` - 发布公告
  - [ ] `GET /api/admin/feedbacks` - 留言列表
  - [ ] `POST /api/admin/feedbacks/:id/reply` - 回复留言
  - [ ] `GET /api/admin/reviews/pending` - 待审核评价
  - [ ] `POST /api/admin/reviews/:id/approve` - 审核评价
  - [ ] `GET /api/admin/agents` - 代理商列表
  - [ ] `POST /api/admin/agents` - 添加代理商
  - [ ] `GET /api/admin/configs` - 系统配置
  - [ ] `PUT /api/admin/configs/:key` - 更新配置

**第5阶段验收标准**:
- ✅ 管理员可以管理用户、技师、订单
- ✅ 数据看板展示正确
- ✅ 财务数据准确
- ✅ 系统配置正常

---

### 🤝 第6阶段：代理端开发 (Day 40-42, 共3天)

#### Day 40: 代理登录和资料

##### 代理认证
- [ ] 创建代理登录页 `/app/(agent)/login/page.tsx`
  - [ ] 手机号+密码登录
  - [ ] NextAuth配置代理角色
- [ ] 实现API
  - [ ] `POST /api/agent/auth/login` - 代理登录
  - [ ] `GET /api/agent/profile` - 获取资料
  - [ ] `PUT /api/agent/profile` - 更新资料

##### 代理布局
- [ ] 创建代理端布局 `/app/(agent)/layout.tsx`
  - [ ] 侧边栏导航
  - [ ] 顶部用户信息
  - [ ] 使用共用组件

#### Day 41: 收益管理

##### 收益列表
- [ ] 创建收益列表页 `/app/(agent)/earnings/page.tsx`
  - [ ] 使用共用EarningsList组件
  - [ ] 收益状态筛选
  - [ ] 分页加载
- [ ] 实现API
  - [ ] `GET /api/agent/earnings` - 收益列表
  - [ ] `GET /api/agent/statistics` - 收益统计

##### 邀请记录
- [ ] 创建邀请记录页 `/app/(agent)/invitations/page.tsx`
  - [ ] 用户/技师筛选
  - [ ] 邀请数据统计
- [ ] 实现API
  - [ ] `GET /api/agent/invitations` - 邀请记录

#### Day 42: 提现功能

##### 提现管理
- [ ] 使用共用提现组件
  - [ ] `/withdrawals/apply` - 提现申请（共用页面）
  - [ ] `/withdrawals` - 提现记录（共用页面）
- [ ] 实现API
  - [ ] `POST /api/agent/withdrawals` - 申请提现
  - [ ] `GET /api/agent/withdrawals` - 提现记录
  - [ ] `GET /api/agent/withdrawals/:id` - 提现详情
  - [ ] `GET /api/agent/withdrawals/statistics` - 提现统计

##### 数据看板
- [ ] 创建代理首页 `/app/(agent)/dashboard/page.tsx`
  - [ ] 收益概览卡片
  - [ ] 邀请统计图表
  - [ ] 最近收益列表

**第6阶段验收标准**:
- ✅ 代理可以登录系统
- ✅ 可以查看收益和邀请记录
- ✅ 可以申请提现
- ✅ 数据统计准确

---

### 💳 第7阶段：支付集成 (Day 43-45)

#### Day 43: SemiPay部署
- [ ] 注册Vercel账号
- [ ] 注册Telegram账号并创建机器人
  - [ ] 与@BotFather对话创建Bot
  - [ ] 获取Bot Token
- [ ] 准备收款码
  - [ ] 微信收款码
  - [ ] 支付宝收款码
- [ ] Fork SemiPay仓库
  - [ ] https://github.com/wanghsinche/semipay
- [ ] 部署到Vercel
  - [ ] 配置环境变量
    - [ ] TELEGRAM_BOT_TOKEN
    - [ ] TELEGRAM_CHAT_ID
    - [ ] 收款码图片URL
  - [ ] 部署成功测试

#### Day 44: 支付集成
- [ ] 修改支付API
  - [ ] `POST /api/user/orders/:id/pay`
    - [ ] 生成支付订单
    - [ ] 调用SemiPay API
    - [ ] 返回支付二维码
- [ ] 创建支付回调API
  - [ ] `POST /api/webhooks/payment`
    - [ ] 验证Telegram通知
    - [ ] 更新订单状态
    - [ ] 触发技师通知
- [ ] 修改支付页面
  - [ ] 显示真实支付二维码
  - [ ] 支付状态轮询
  - [ ] 支付成功跳转
- [ ] 创建支付检查API
  - [ ] `GET /api/user/orders/:id/payment-status`
    - [ ] 查询支付状态

#### Day 45: 支付测试
- [ ] 小额真实支付测试
  - [ ] 支付0.01元
  - [ ] 验证Telegram通知
  - [ ] 验证订单状态更新
- [ ] 异常情况测试
  - [ ] 支付超时
  - [ ] 重复支付
  - [ ] 金额不匹配
- [ ] 修复发现的问题

**第6阶段验收标准**:
- ✅ SemiPay部署成功
- ✅ 真实支付流程完整
- ✅ Telegram通知正常
- ✅ 订单状态正确更新

---

### 🚀 第8阶段：高级功能 (Day 46-52)

#### Day 46-47: 腾讯地图集成
- [ ] 腾讯地图API Key（已获取）
  - [ ] API Key: XF5BZ-SACWC-J7V27-A36VI-TWGQ3-N2BWX
- [ ] 安装地图SDK
  ```bash
  npm install @map.qq.com/map-jssdk
  ```
- [ ] 实现地图选点功能
  - [ ] 创建地图组件
  - [ ] 地址搜索
  - [ ] 点击地图获取坐标
  - [ ] 逆地理编码(坐标→地址)
- [ ] 集成到下单页面
  - [ ] 替换地址输入为地图选点
  - [ ] 保存经纬度
- [ ] 集成到技师资料页
  - [ ] 服务地址选点
  - [ ] 服务半径设置
- [ ] 距离计算功能
  - [ ] 计算用户到技师的距离
  - [ ] 显示预计时间

#### Day 48: 语音通知系统
- [ ] 注册阿里云语音服务
  - [ ] 实名认证
  - [ ] 购买语音套餐
  - [ ] 申请语音模板
- [ ] 安装阿里云SDK
  ```bash
  npm install @alicloud/pop-core
  ```
- [ ] 创建语音通知工具
  - [ ] `lib/voice-notification.ts`
  - [ ] 语音模板配置
  - [ ] 调用阿里云API
- [ ] 集成到订单流程
  - [ ] 支付成功后30秒触发
  - [ ] 播报订单信息
  - [ ] 最多重拨3次
- [ ] 测试语音通知
  - [ ] 创建测试订单
  - [ ] 验证语音接通
  - [ ] 验证内容播报

#### Day 49-50: 邀请分佣系统
- [ ] 邀请码生成逻辑
  - [ ] 用户注册时生成8位码
  - [ ] 技师审核通过后生成8位码
- [ ] 邀请关系建立
  - [ ] 注册时绑定邀请人
  - [ ] 记录邀请关系表
- [ ] 分佣计算逻辑
  - [ ] 订单完成时触发
  - [ ] 计算用户推荐佣金(10%)
  - [ ] 计算技师推荐分成(5%)
  - [ ] 计算代理佣金(可配置)
  - [ ] 记录收益表
- [ ] 收益结算
  - [ ] 订单完成后立即结算
  - [ ] 更新可提现余额
- [ ] 二维码生成
  - [ ] 安装qrcode库
    ```bash
    npm install qrcode.react
    ```
  - [ ] 生成邀请链接
  - [ ] 生成二维码图片

#### Day 51: 文件存储配置
- [ ] 创建文件存储目录结构
  ```bash
  mkdir -p /var/www/junyue-spa/uploads/{avatars,therapist-photos,therapist-videos,evidence}
  mkdir -p /var/www/junyue-spa/backups
  ```
- [ ] 安装图片处理库
  ```bash
  npm install sharp nanoid
  ```
- [ ] 开发文件上传API
  - [ ] 创建 app/api/upload/route.ts
  - [ ] 实现文件验证（类型、大小）
  - [ ] 实现图片自动压缩转WebP（Sharp）
  - [ ] 视频文件直接存储
  - [ ] 返回本地URL路径
- [ ] 配置Nginx静态文件托管
  - [ ] 配置 location /uploads/ 路径
  - [ ] 启用浏览器缓存（30天）
  - [ ] 配置防盗链保护
  - [ ] 启用视频流媒体支持（mp4模块）
  - [ ] 启用Gzip压缩
- [ ] 创建运维脚本
  - [ ] 编写自动备份脚本（scripts/backup.sh）
  - [ ] 编写磁盘监控脚本（scripts/monitor-disk.sh）
  - [ ] 设置定时任务（crontab）
- [ ] 测试上传功能
  - [ ] 测试图片上传和压缩
  - [ ] 测试视频上传
  - [ ] 验证文件访问速度（华纳云CN2加速）

#### Day 52: 高级功能测试
- [ ] 完整流程测试
  - [ ] 用户注册(带邀请码)
  - [ ] 下单(地图选址)
  - [ ] 支付(真实支付)
  - [ ] 语音通知(真实接听)
  - [ ] 技师接单
  - [ ] 完成订单
  - [ ] 分佣结算
  - [ ] 查看收益
- [ ] 性能测试
  - [ ] 页面加载速度
  - [ ] API响应时间
  - [ ] 图片加载优化
- [ ] 修复问题

**第8阶段验收标准**:
- ✅ 地图功能正常
- ✅ 语音通知可用
- ✅ 分佣计算准确
- ✅ 文件上传稳定

---

### 🧪 第9阶段：测试优化 (Day 53-59)

#### Day 53-54: 功能测试
- [ ] 用户端完整测试
  - [ ] 所有页面访问
  - [ ] 所有功能操作
  - [ ] 边界情况测试
  - [ ] 错误处理测试
- [ ] 技师端完整测试
  - [ ] 注册审核流程
  - [ ] 订单管理流程
  - [ ] 收益提现流程
- [ ] 管理端完整测试
  - [ ] 数据看板准确性
  - [ ] 审核功能
  - [ ] 财务数据
- [ ] 记录所有Bug
  - [ ] 创建Bug清单
  - [ ] 分级处理(P0/P1/P2)

#### Day 55-56: Bug修复
- [ ] 修复P0级别Bug(阻塞性)
  - [ ] 登录失败
  - [ ] 支付失败
  - [ ] 数据丢失
  - [ ] 页面崩溃
- [ ] 修复P1级别Bug(严重)
  - [ ] 功能异常
  - [ ] 数据错误
  - [ ] 体验问题
- [ ] 修复P2级别Bug(一般)
  - [ ] UI问题
  - [ ] 小功能问题
- [ ] 回归测试
  - [ ] 验证修复效果
  - [ ] 确保无新问题

#### Day 57: 性能优化
- [ ] 前端性能优化
  - [ ] 代码分割
    - [ ] 使用dynamic import
    - [ ] 路由级别代码分割
  - [ ] 图片优化
    - [ ] 使用Next.js Image组件
    - [ ] 懒加载
    - [ ] WebP格式
  - [ ] 缓存优化
    - [ ] API响应缓存
    - [ ] 静态资源缓存
  - [ ] 打包优化
    - [ ] 减少bundle大小
    - [ ] Tree shaking
- [ ] 后端性能优化
  - [ ] 数据库查询优化
    - [ ] 添加必要索引
    - [ ] 优化复杂查询
    - [ ] 使用select避免查询所有字段
  - [ ] API响应优化
    - [ ] 减少查询次数
    - [ ] 数据分页
    - [ ] 响应压缩
  - [ ] 缓存策略
    - [ ] Redis缓存热点数据
    - [ ] 技师列表缓存
    - [ ] 统计数据缓存

#### Day 58: 安全加固
- [ ] 认证安全
  - [ ] JWT Token加密
  - [ ] Token过期时间
  - [ ] 刷新Token机制
- [ ] 数据安全
  - [ ] 敏感信息加密
    - [ ] 密码bcrypt
    - [ ] 身份证AES加密
    - [ ] 银行卡AES加密
  - [ ] SQL注入防护(Prisma自动防护)
  - [ ] XSS防护
    - [ ] 输入验证
    - [ ] 输出转义
- [ ] 接口安全
  - [ ] API频率限制
  - [ ] CORS配置
  - [ ] CSRF防护
- [ ] 文件上传安全
  - [ ] 文件类型验证
  - [ ] 文件大小限制
  - [ ] 文件名处理

#### Day 59: 用户体验优化
- [ ] Loading状态完善
  - [ ] 所有API调用显示Loading
  - [ ] 使用Skeleton加载占位
  - [ ] 使用Loader组件(12种变体)
- [ ] 错误提示优化
  - [ ] 友好的错误信息
  - [ ] Toast通知
  - [ ] 错误页面
- [ ] 空状态优化
  - [ ] 使用Empty State组件
  - [ ] 引导用户操作
- [ ] 移动端适配
  - [ ] 所有页面响应式检查
  - [ ] 触摸交互优化
  - [ ] 底部安全区域
- [ ] 无障碍优化
  - [ ] 语义化HTML
  - [ ] ARIA属性
  - [ ] 键盘导航

**第8阶段验收标准**:
- ✅ 所有P0/P1 Bug修复
- ✅ 页面加载<3秒
- ✅ API响应<500ms
- ✅ 移动端体验良好
- ✅ 安全检查通过

---

### 🚀 第10阶段：部署上线 (Day 60-61)

#### Day 60: 服务器部署
- [ ] 服务器环境准备
  - [ ] 购买华纳云香港CN2服务器
  - [ ] 系统：Ubuntu 22.04
  - [ ] 配置：4核8G 100GB SSD
- [ ] 安装必要软件
  ```bash
  # 更新系统
  sudo apt update && sudo apt upgrade -y
  
  # 安装Node.js 22
  curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
  sudo apt-get install -y nodejs
  
  # 安装PostgreSQL 16
  sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
  wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
  sudo apt-get update
  sudo apt-get install -y postgresql-16
  
  # 安装Redis
  sudo apt install -y redis-server
  
  # 安装Nginx
  sudo apt install -y nginx
  
  # 安装PM2
  sudo npm install -g pm2
  ```
- [ ] 配置PostgreSQL
  ```bash
  # 创建数据库和用户
  sudo -u postgres psql
  CREATE DATABASE junyue_spa;
  CREATE USER junyue_user WITH PASSWORD 'strong_password';
  GRANT ALL PRIVILEGES ON DATABASE junyue_spa TO junyue_user;
  ```
- [ ] 配置防火墙
  ```bash
  sudo ufw allow 22    # SSH
  sudo ufw allow 80    # HTTP
  sudo ufw allow 443   # HTTPS
  sudo ufw enable
  ```

#### Day 60 下午: 代码部署
- [ ] 上传代码到服务器
  ```bash
  # 本地打包
  git archive --format=tar.gz -o junyue-spa.tar.gz HEAD
  
  # 上传到服务器
  scp junyue-spa.tar.gz user@server:/var/www/
  
  # 服务器解压
  ssh user@server
  cd /var/www
  tar -xzf junyue-spa.tar.gz -C junyue-spa
  ```
- [ ] 安装依赖
  ```bash
  cd /var/www/junyue-spa
  npm install --production
  ```
- [ ] 配置环境变量
  ```bash
  # 创建.env.production
  DATABASE_URL="postgresql://junyue_user:password@localhost:5432/junyue_spa"
  DIRECT_URL="postgresql://junyue_user:password@localhost:5432/junyue_spa"
  NEXTAUTH_SECRET="production-secret-key"
  NEXTAUTH_URL="https://junyue-spa.com"
  
  # 腾讯地图API配置
  NEXT_PUBLIC_TENCENT_MAP_KEY="XF5BZ-SACWC-J7V27-A36VI-TWGQ3-N2BWX"
  
  # 支付配置
  SEMIPAY_URL="https://your-semipay.vercel.app"
  
  # 语音通知配置
  ALI_ACCESS_KEY_ID="..."
  ALI_ACCESS_KEY_SECRET="..."
  ```
- [ ] 运行数据库迁移
  ```bash
  npx prisma migrate deploy
  npx prisma db seed
  ```
- [ ] 构建项目
  ```bash
  npm run build
  ```
- [ ] 启动应用
  ```bash
  pm2 start npm --name "junyue-spa" -- start
  pm2 save
  pm2 startup
  ```

#### Day 61: Nginx配置和SSL
- [ ] 配置Nginx
  ```nginx
  # /etc/nginx/sites-available/junyue-spa
  server {
      listen 80;
      server_name junyue-spa.com www.junyue-spa.com;
      
      location / {
          proxy_pass http://localhost:3000;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection 'upgrade';
          proxy_set_header Host $host;
          proxy_cache_bypass $http_upgrade;
      }
  }
  ```
  ```bash
  sudo ln -s /etc/nginx/sites-available/junyue-spa /etc/nginx/sites-enabled/
  sudo nginx -t
  sudo systemctl restart nginx
  ```
- [ ] 配置SSL证书(Let's Encrypt)
  ```bash
  sudo apt install -y certbot python3-certbot-nginx
  sudo certbot --nginx -d junyue-spa.com -d www.junyue-spa.com
  ```
- [ ] 配置自动续期
  ```bash
  sudo systemctl status certbot.timer
  ```

#### Day 61 下午: 最终测试
- [ ] 生产环境测试
  - [ ] 访问正式域名
  - [ ] 用户端完整流程
  - [ ] 技师端完整流程
  - [ ] 管理端完整流程
  - [ ] 真实支付测试
- [ ] 性能测试
  - [ ] 页面加载速度
  - [ ] API响应时间
  - [ ] 并发测试
- [ ] 安全检查
  - [ ] SSL证书验证
  - [ ] HTTPS强制跳转
  - [ ] 安全头配置
- [ ] 备份配置
  ```bash
  # 数据库自动备份脚本
  sudo crontab -e
  0 3 * * * pg_dump -U junyue_user junyue_spa > /backup/db_$(date +\%Y\%m\%d).sql
  ```
- [ ] 监控配置
  ```bash
  # PM2监控
  pm2 monit
  
  # 日志查看
  pm2 logs
  ```

**第9阶段验收标准**:
- ✅ 服务器环境配置完成
- ✅ 应用成功部署运行
- ✅ SSL证书配置成功
- ✅ 生产环境测试通过
- ✅ 备份和监控就绪

---

## 🚨 技术难点预判

### 难点1：双积分系统逻辑
**难度**: ⭐⭐⭐⭐
**解决方案**:
- 使用数据库事务确保积分变动原子性
- 积分过期检查使用定时任务(cron job)
- 签到规则用配置表管理，方便调整
- 积分使用优先级在下单时计算

### 难点2：订单状态流转
**难度**: ⭐⭐⭐⭐
**解决方案**:
- 使用状态机模式管理订单状态
- 每次状态变更记录日志
- 超时检查使用定时任务
- 语音通知失败有降级方案(短信/站内信)

### 难点3：分佣计算准确性
**难度**: ⭐⭐⭐⭐⭐
**解决方案**:
- 订单完成时触发分佣计算
- 使用数据库事务保证一致性
- 记录详细的分佣日志
- 定期对账检查数据准确性

### 难点4：实时通知
**难度**: ⭐⭐⭐
**解决方案**:
- 技师接单后使用轮询查询订单状态
- 未来可升级为WebSocket实时推送
- 语音通知使用第三方服务(阿里云)

### 难点5：文件上传和存储
**难度**: ⭐⭐⭐
**解决方案**:
- 使用对象存储(腾讯云COS)
- 前端使用FormData上传
- 后端验证文件类型和大小
- 返回CDN URL

---

## 🛡️ 风险控制

### 风险1：进度延期
**风险等级**: 中
**应对措施**:
- 每周复盘进度，及时调整计划
- P2/P3功能可以延后到二期
- 核心功能优先保证质量

### 风险2：技术选型问题
**风险等级**: 低
**应对措施**:
- 技术栈成熟稳定(Next.js生态)
- 有问题可快速查阅文档和社区

### 风险3：第三方服务不稳定
**风险等级**: 中
**应对措施**:
- 语音通知有降级方案(短信)
- 支付使用开源方案(SemiPay)
- 地图有备选方案(高德地图)

### 风险4：数据安全问题
**风险等级**: 高
**应对措施**:
- 敏感信息加密存储
- 定期数据库备份
- 服务器安全加固
- 定期安全审计

---

## ✅ 质量保证

### 代码质量
- [ ] TypeScript严格模式
- [ ] ESLint检查
- [ ] Prettier格式化
- [ ] 代码审查(自我审查)

### 测试覆盖
- [ ] 手动功能测试
- [ ] 边界情况测试
- [ ] 异常情况测试
- [ ] 性能测试

### 文档完善
- [ ] API文档(已完成)
- [ ] 数据库文档(已完成)
- [ ] 部署文档(本阶段完成)
- [ ] 用户手册(可选)

---

## 📊 进度追踪

### 每日打卡
```markdown
Day X (YYYY-MM-DD)
- [ ] 完成任务1
- [ ] 完成任务2
- [ ] 完成任务3
遇到的问题：
- 问题描述
解决方案：
- 解决方案
明日计划：
- 计划任务
```

### 每周总结
```markdown
Week X (YYYY-MM-DD ~ YYYY-MM-DD)
完成情况：
- ✅ 已完成：XX个任务
- 🔄 进行中：XX个任务
- ⏸️ 延后：XX个任务
本周亮点：
- 亮点1
- 亮点2
下周重点：
- 重点1
- 重点2
```

---

## 🎯 里程碑

| 里程碑 | 日期 | 标志 |
|-------|------|------|
| M1: 环境搭建完成 | Day 3 | 项目可运行 |
| M2: 数据库就绪 | Day 5 | 数据表创建成功 |
| M3: 用户端MVP | Day 19 | 用户可下单 |
| M4: 技师端MVP | Day 29 | 技师可接单 |
| M5: 管理端MVP | Day 39 | 管理员可管理 |
| M6: 代理端完成 | Day 42 | 代理端可用 |
| M7: 支付上线 | Day 45 | 真实支付可用 |
| M8: 全功能完成 | Day 52 | 所有功能就绪 |
| M9: 测试完成 | Day 59 | 可上线 |
| M10: 正式上线 | Day 61 | 生产环境运行 |

---

## 📝 总结

**预计完成时间**: 58天 ≈ **8周**  
**实际开始日期**: 2025-10-08  
**预计上线日期**: 2025-11-25

**核心产出**:
- ✅ 用户端(20+页面)
- ✅ 技师端(15+页面)
- ✅ 管理端(15+页面)
- ✅ 120个API接口
- ✅ 35张数据表
- ✅ 完整支付流程
- ✅ 邀请分佣系统
- ✅ 生产环境部署

**成功关键**:
1. 严格按照计划执行
2. 核心功能优先保证
3. 及时记录和解决问题
4. 保持代码质量
5. 充分测试验证

**加油！💪 一次性开发完成君悦SPA平台！**

---

**文档结束**

